# Gap Matrix (Frontend → Backend)

Legend: Coverage checks DocType, API, permissions, workspace, and field compatibility. Evidence references file paths/symbols.

| Feature / Entity | Frontend Evidence | Backend Coverage | Gap / Notes |
|---|---|---|---|
| Auth v2 (device token) | `src/lib/cloudAuth.ts` (registerCloudAccount/loginCloud), `src/lib/apiClient.ts` (apiRegisterUserV2/apiLoginV2/apiMeV2) | `hisabi_backend/api/v1/auth_v2.py` (register_user/login/me/logout/device_revoke) | **Match** on endpoints; verify response shape matches frontend expectations (`auth.token`, `default_wallet_id`). |
| Devices list + revoke | `src/lib/devicesClient.ts` (fetchDevicesList/revokeDevice), `src/pages/DevicesPage.tsx` | `hisabi_backend/api/v1/devices.py` (devices_list/revoke_device) | **Match** on endpoints; verify response keys (`devices` list + fields) align. |
| Wallets & membership | `src/lib/walletRemoteService.ts` (walletsList/walletCreate/invite flows), `src/pages/WalletsPage.tsx` | `hisabi_backend/api/v1/wallets.py` (wallets_list/wallet_create/wallet_invite_create/accept/wallet_member_remove/wallet_leave) | **Mostly aligned**. Frontend wallet model includes `isDefault`, `role`, `memberStatus` in `src/lib/db.ts` (Wallet) but backend `Hisabi Wallet` lacks these fields (`hisabi_backend/doctype/hisabi_wallet/hisabi_wallet.json`). |
| Accounts | `src/lib/db.ts` (Account), `src/lib/dataLayer/accountRepo.ts` | `hisabi_backend/doctype/hisabi_account/hisabi_account.json` | **Field mapping needed**: frontend `name` vs backend `account_name`; frontend uses `type` vs backend `account_type`. Sync layer currently maps via `transformToFrappe` only (snake_case), not semantic renames. |
| Categories | `src/lib/db.ts` (Category), `src/lib/dataLayer/categoryRepo.ts` | `hisabi_backend/doctype/hisabi_category/hisabi_category.json` | **Field mapping needed**: frontend `name` vs backend `category_name`; `parentId` vs `parent_category`. |
| Transactions | `src/lib/db.ts` (Transaction), `src/lib/dataLayer/transactionRepo.ts` | `hisabi_backend/doctype/hisabi_transaction/hisabi_transaction.json` | **Missing fields**: frontend `attachments[]` has no backend field; `bucketId` is a bucket link but backend `bucket` is Data (not Link). Field name mapping (`type` → `transaction_type`, `dateTime` → `date_time`) also needed. |
| Buckets | `src/lib/db.ts` (Bucket), `src/lib/bucketService.ts` | `hisabi_backend/doctype/hisabi_bucket/hisabi_bucket.json` | **Field mapping needed**: frontend `name` vs backend `bucket_name`. |
| Allocation Rules + Lines | `src/lib/db.ts` (AllocationRule/AllocationRuleLine), `src/lib/bucketService.ts` | `hisabi_backend/doctype/hisabi_allocation_rule*.json` | **Field mapping needed**: rule `name` vs `rule_name`, `scopeRefId` vs `scope_ref`. Backend validation enforces percent totals (`hisabi_backend/doctype/hisabi_allocation_rule_line.py`). |
| Transaction Allocations | `src/lib/db.ts` (TransactionAllocation) | `hisabi_backend/doctype/hisabi_transaction_allocation/hisabi_transaction_allocation.json` | **Mapping needed**: `transactionId` → `transaction`, `bucketId` → `bucket`, `ruleIdUsed` → `rule_used`. |
| Budgets | `src/lib/db.ts` (Budget), `src/pages/BudgetsPage.tsx` | `hisabi_backend/doctype/hisabi_budget/hisabi_budget.json` | **Mismatch**: frontend uses `amountBase` only (no `currency`/`amount`), backend requires `currency` + `amount`. Frontend report expects `budget` key in report rows (`src/domain/financeReports.ts`) while backend returns `name`. |
| Goals | `src/lib/db.ts` (Goal), `src/pages/GoalsPage.tsx` | `hisabi_backend/doctype/hisabi_goal/hisabi_goal.json` | **Mismatch**: frontend model lacks `currency`, `target_amount`, `progress_percent`, `remaining_amount`. Report expects `goal` key (`src/domain/financeReports.ts`) while backend returns `name`. |
| Debts | `src/lib/db.ts` (Debt), `src/pages/DebtsPage.tsx` | `hisabi_backend/doctype/hisabi_debt/hisabi_debt.json` | **Field mismatch**: frontend `name` is debt label; backend uses `debt_name` + `counterparty_name`. Map required. |
| Debt Installments | `src/lib/db.ts` (DebtInstallment), `src/lib/dataLayer/debtRepo.ts` | `hisabi_backend/doctype/hisabi_debt_installment/hisabi_debt_installment.json` | **Mapping required**: `debtId` → `debt`, `paidAt` → `paid_at`. |
| Debt Requests | `src/lib/db.ts` (DebtRequest), `src/lib/debtsClient.ts` | `hisabi_backend/doctype/hisabi_debt_request/hisabi_debt_request.json`, `hisabi_backend/api/v1/debts.py` | **Status mismatch**: frontend uses `rejected`, backend uses `declined` (`hisabi_backend/doctype/hisabi_debt_request.py`). |
| Jameya + payments | `src/lib/db.ts` (Jameya/JameyaPayment), `src/lib/jameyaClient.ts` | `hisabi_backend/doctype/hisabi_jameya*.json`, `hisabi_backend/api/v1/jameya.py` | **Mostly aligned**; mapping of field names (`name` → `jameya_name`, etc) required for sync payloads. |
| FX Rates | `src/lib/db.ts` (FxRate), `src/lib/exchangeRateService.ts` | `hisabi_backend/doctype/hisabi_fx_rate/hisabi_fx_rate.json` | **Sync gap**: frontend sync engine does not pull/push FX rates (`src/lib/syncEngine.ts` tableMap). |
| Custom Currencies | `src/lib/db.ts` (CustomCurrency) | `hisabi_backend/doctype/hisabi_custom_currency/hisabi_custom_currency.json` | **Sync gap**: not included in `syncEngine.ts` tableMap. |
| User Settings | `src/lib/db.ts` (UserSettings) | `hisabi_backend/doctype/hisabi_settings/hisabi_settings.json` | **Field mismatch**: frontend has `selectedWalletId`, backend lacks this field. Mapping needed for `enabledCurrencies` vs `enabled_currencies` JSON. |
| Attachments / receipts | `src/lib/db.ts` (Attachment), `src/lib/dataLayer/attachmentRepo.ts`, `src/lib/attachments/uploadService.ts` | **Missing DocType**: `Hisabi Attachment` referenced in backend sync + hooks but no DocType exists | **Critical gap**: frontend sync expects `Hisabi Attachment` in pull and pushes metadata; backend missing DocType + endpoints. |
| Sync push/pull contract | `src/lib/syncEngine.ts`, `src/lib/apiClient.ts` (apiSyncPush/apiSyncPull) | `hisabi_backend/api/v1/sync.py` (sync_push/sync_pull) | **Potential mismatch**: frontend may enqueue entity types not in backend DOCTYPE_LIST (e.g., subscriptions/split bills); backend will reject as unsupported. |
| Finance report summary | `src/domain/financeReports.ts` (ReportSummaryResponse), `src/pages/HomePage.tsx` | `hisabi_backend/api/v1/reports_finance.py` (report_summary) | **Response shape mismatch**: backend totals keys `total_income/total_expense` vs frontend `totals.income/expense/net`; accounts list uses `name` not `account`. |
| Budget report | `src/domain/financeReports.ts` (BudgetReportRow expects `budget`, `percent`) | `hisabi_backend/api/v1/reports_finance.py` (report_budgets) | **Response mismatch**: backend returns `name` and `spent_percent`; frontend reads `budget` and `percent` (`src/pages/BudgetsPage.tsx`). |
| Goals report | `src/domain/financeReports.ts` (GoalReportRow expects `goal`) | `hisabi_backend/api/v1/reports_finance.py` (report_goals) | **Response mismatch**: backend returns `name`, frontend expects `goal` (`src/pages/GoalsPage.tsx`). |
| Debts report | `src/domain/financeReports.ts` (DebtReportRow expects `name`) | `hisabi_backend/api/v1/reports_finance.py` (report_debts) | **Mostly aligned** but totals object (`DebtReportTotals`) not returned by backend. |
| Bucket reports | `src/domain/reports.ts` (BucketRule expects `rule`) | `hisabi_backend/api/v1/reports.py` (bucket_rules) | **Response mismatch**: backend returns `name` field for rule, frontend expects `rule`. |
| Report cache | `src/lib/reportCache.ts` / `src/lib/db.ts` (ReportCacheEntry) | No backend DocType / API | **Local-only** caching; no server support. |
| Subscriptions | `src/pages/SubscriptionsPage.tsx`, `src/lib/dataLayer/subscriptionRepo.ts` | No backend DocType/API | **Missing backend**; sync queue will attempt to push `Hisabi Subscription` (see `src/lib/dataLayer/entityTypes.ts`) but backend DOCTYPE_LIST excludes it. |
| Split bills | `src/pages/SplitBillsPage.tsx`, `src/lib/dataLayer/splitBillRepo.ts` | No backend DocType/API | **Missing backend**; same sync incompatibility as subscriptions. |
| Family / groups | `src/pages/FamilyPage.tsx`, `src/lib/services/familyService.ts`, `src/lib/db.ts` group entities | No backend DocType/API | **Missing backend** for group features, budgets, rewards, shared wallets, settlements. |
| Notifications | `src/lib/notificationService.ts`, `src/components/notifications/*` | No backend API | **Local-only**; no server push/pull. |
| Education / Community / AI services | `src/pages/EducationPage.tsx`, `src/lib/educationService.ts`, `src/pages/CommunityPage.tsx`, `src/lib/ai/*` | No backend APIs | **Local-only**; no backend support currently. |
| Conflict center | `src/pages/ConflictCenterPage.tsx`, `src/lib/conflictService.ts` | Backend returns conflicts in `sync_push` (`hisabi_backend/api/v1/sync.py`) | **Needs attachment DocType + consistent conflict payloads**; otherwise conflict center can’t reconcile attachments or unsupported entities. |
| Workspace coverage | Frontend includes many features (subscriptions, split bills, family, reports) | Workspace fixture only links core doctypes (`hisabi_backend/workspace/hisabi/hisabi.json`) | **Workspace missing links** for newly added entities/features. |

