# Sync Contract Matrix (WP3.1-A)

Source of truth used: frontend sync reports + frontend sync code + backend sync implementation.

Columns: entity_type | direction | required_keys | optional_keys | id_fields | wallet_scope | delete_fields | conflict_policy | evidence(frontend) | evidence(backend)

| entity_type | direction | required_keys | optional_keys | id_fields | wallet_scope | delete_fields | conflict_policy | evidence(frontend) | evidence(backend) |
|---|---|---|---|---|---|---|---|---|---|
| Hisabi Wallet | push | entity_type, entity_id, operation, payload.clientId, payload.walletName, payload.status | payload.clientCreatedMs, clientModifiedMs, docVersion, serverModified, isDeleted, deletedAt | client_id == name (entity_id/client_id) | wallet create: wallet_id in request must equal client_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/walletService.ts:88-115; hisabi-your-smart-wallet/src/lib/db.ts:88-105; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:248-267; hisabi_backend/hisabi_backend/api/v1/sync.py:552-556; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Wallet | pull | name/client_id, server_modified, doc_version, plus full wallet record fields (wallet_name, status, etc.) | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters wallet by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push (server returns conflict objects) | hisabi-your-smart-wallet/src/lib/syncEngine.ts:390-406; hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:88-105 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Wallet Member | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.userId, payload.role, payload.status | payload.joinedAt, removedAt, docVersion, serverModified | client_id/entity_id from client; server uses wallet+user uniqueness | wallet member scoped by wallet; wallet access required | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/src/lib/db.ts:107-117; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/doctype/hisabi_wallet_member/hisabi_wallet_member.json:21-101; hisabi_backend/hisabi_backend/api/v1/sync.py:546-560; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Wallet Member | pull | name/client_id, server_modified, doc_version, wallet/user/role/status | joined_at, removed_at, is_deleted, deleted_at | frontend derives id as `${walletId}:${userId}` | pull filters wallet members by wallet | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:406-421; hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:107-117 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Account | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.name, payload.type, payload.currency | openingBalance, currentBalance, color, icon, archived, sortOrder, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:119-133; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:68-75; hisabi_backend/hisabi_backend/api/v1/sync.py:248-276; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Account | pull | name/client_id, server_modified, doc_version, plus account fields (account_name/type/currency, etc.) | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:119-133 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Category | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.name, payload.kind | parentId, color, icon, archived, sortOrder, defaultBucketId, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:135-148; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:75-79; hisabi_backend/hisabi_backend/api/v1/sync.py:248-276; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Category | pull | name/client_id, server_modified, doc_version, plus category fields (category_name/kind, etc.) | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:135-148 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Transaction | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.type, payload.dateTime, payload.amount, payload.currency, payload.accountId | toAccountId, categoryId, bucketId, note, attachments, fxRateUsed, amountBase, deletedAt, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id and link ownership | delete => is_deleted/deleted_at soft delete (client uses deletedAt/isDeleted) | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:173-191; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/src/lib/syncEngine.ts:395-399; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:109-115; hisabi_backend/utils/validators.py:87-137; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Transaction | pull | name/client_id, server_modified, doc_version, plus transaction fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:395-399; hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:173-191 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Debt | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.name, payload.direction, payload.principalAmount | currency, remainingAmount, status, counterpartyType, counterpartyPhone, confirmed, note, dueDate, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:193-209; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:107-108; hisabi_backend/hisabi_backend/api/v1/sync.py:248-276; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Debt | pull | name/client_id, server_modified, doc_version, plus debt fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:193-209 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Debt Installment | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.debtId, payload.amount | dueDate, status, paidAt, paidAmount, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id and link ownership | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:211-221; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/utils/validators.py:103-107; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Debt Installment | pull | name/client_id, server_modified, doc_version, plus installment fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:211-221 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Debt Request | push | entity_type, entity_id, operation, payload.clientId, payload.walletId | fromPhone, toPhone, debtPayload, status, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:223-239; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Debt Request | pull | name/client_id, server_modified, doc_version, plus debt request fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:223-239 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Budget | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.name, payload.period, payload.scopeType, payload.amountBase | categoryId, spentAmount, startDate, endDate, alertThreshold, archived, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:241-255; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:95-99; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Budget | pull | name/client_id, server_modified, doc_version, plus budget fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:241-255 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Goal | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.type, payload.name, payload.targetAmountBase | currentAmount, targetDate, linkedAccountId, linkedDebtId, status, color, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:258-272; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:100-105; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Goal | pull | name/client_id, server_modified, doc_version, plus goal fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:258-272 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Bucket | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.name | color, icon, sortOrder, archived, deletedAt, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:337-348; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:80-80; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Bucket | pull | name/client_id, server_modified, doc_version, plus bucket fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:337-348 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Allocation Rule | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.name, payload.scopeType | isDefault, scopeRefId, active, deletedAt, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:350-361; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:81-86; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Allocation Rule | pull | name/client_id, server_modified, doc_version, plus allocation rule fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:350-361 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Allocation Rule Line | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.ruleId, payload.bucketId | percent, sortOrder, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id and link ownership | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:363-371; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:86-89; hisabi_backend/utils/validators.py:98-107; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Allocation Rule Line | pull | name/client_id, server_modified, doc_version, plus allocation rule line fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:363-371 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Transaction Allocation | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.transactionId, payload.bucketId | percent, amount, currency, amountBase, ruleIdUsed, isManualOverride, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id and link ownership | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:374-386; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:90-94; hisabi_backend/utils/validators.py:98-107; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Transaction Allocation | pull | name/client_id, server_modified, doc_version, plus transaction allocation fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:374-386 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Jameya | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.name, payload.monthlyAmount, payload.totalMembers, payload.myTurn, payload.startDate | currency, totalAmount, period, status, note, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:412-427; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:108-109; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Jameya | pull | name/client_id, server_modified, doc_version, plus jameya fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:412-427 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Jameya Payment | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.jameyaId | periodNumber, dueDate, amount, status, paidAt, isMyTurn, clientCreatedMs, clientModifiedMs, docVersion, serverModified | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id and link ownership | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:429-440; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/utils/validators.py:104-107; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Jameya Payment | pull | name/client_id, server_modified, doc_version, plus jameya payment fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:429-440 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
| Hisabi Attachment | push | entity_type, entity_id, operation, payload.clientId, payload.walletId, payload.ownerEntityType, payload.ownerClientId, payload.fileMime, payload.fileSize | fileName, sha256, remoteFileId, remoteFileUrl, clientCreatedMs, clientModifiedMs, docVersion, serverModified, isDeleted, deletedAt | client_id == name (entity_id/client_id) | wallet-scoped; server enforces wallet_id and link ownership | delete => is_deleted/deleted_at soft delete | base_version required for update/delete; conflict if base_version != doc_version | hisabi-your-smart-wallet/src/lib/syncTypes.ts:1-19; hisabi-your-smart-wallet/src/lib/db.ts:451-474; hisabi-your-smart-wallet/src/lib/syncEngine.ts:211-215; hisabi-your-smart-wallet/REPORT_frontend_api_contract.md:56-64 | hisabi_backend/hisabi_backend/api/v1/sync.py:29-52; hisabi_backend/utils/validators.py:106-107; hisabi_backend/utils/sync_common.py:12-60; hisabi_backend/hisabi_backend/api/v1/sync.py:439-533 |
| Hisabi Attachment | pull | name/client_id, server_modified, doc_version, plus attachment fields | client_created_ms, client_modified_ms, is_deleted, deleted_at | server record uses name/client_id; frontend maps attachment fields | pull filters by wallet_id | is_deleted/deleted_at triggers local delete | conflicts handled on push | hisabi-your-smart-wallet/src/lib/syncEngine.ts:433-456; hisabi-your-smart-wallet/src/lib/syncEngine.ts:467-486; hisabi-your-smart-wallet/src/lib/db.ts:451-474 | hisabi_backend/hisabi_backend/api/v1/sync.py:707-745; hisabi_backend/utils/sync_common.py:12-60 |
